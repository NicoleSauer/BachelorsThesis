\section{Integration von Blockchain}
\label{sec:blockchainintegration}


\subsection{Auswahl der Blockchain}
Für die Integration der Blockchain in das Protokoll wurde zunächst eine geeignete Blockchain gesucht. Dabei wurde sich auf die beiden bekanntesten Blockchains, Bitcoin und Ethereum, beschränkt. Da Bitcoin eine reine Kryptowährung ist und keine Smart Contracts unterstützt, wurde sich für Ethereum entschieden. Ethereum ist eine Blockchain, die zwar auch eine Kryptowährung, Ether, besitzt, aber zusätzlich auch Smart Contracts unterstützt. Der Grund für die Existenz einer Währung auf der Blockchain ist, dass die Smart Contracts, die auf der Blockchain ausgeführt werden, mit Ether bezahlt werden müssen \parencite[S. 2]{Antonopoulos_MasteringEthereum}. Somit ist es nicht möglich, Smart Contracts auf der Blockchain auszuführen, ohne Ether zu besitzen. Da die Smart Contracts auf der Blockchain aber mit Ether bezahlt werden müssen, ist es notwendig, dass jeder Nutzer, der einen Smart Contract ausführen möchte, Ether besitzt.


\subsection{Registrierung}
Um das Protokoll zu nutzen, muss sich jeder Nutzer zunächst auf der Blockchain registrieren. Dazu muss ein Smart Contract auf der Blockchain ausgeführt werden, der die Registrierung des Nutzers durchführt. Dieser Smart Contract wird mit dem Benutzernamen und dem statischen öffentlichen Schlüssel aufgerufen. Der statische öffentliche Schlüssel wird bei der Registrierung festgelegt und kann nicht mehr geändert werden. Der Smart Contract erstellt einen neuen Eintrag in der Blockchain, der den Benutzernamen und den öffentlichen Schlüssel des Nutzers enthält. Der Smart Contract wird nur einmalig bei der Registrierung aufgerufen. Sollte ein Nutzer seinen Benutzernamen ändern wollen, muss er sich mit dem neuen Benutzernamen und dem öffentlichen Schlüssel eines neu erzeugten statischen Schlüsselpaars erneut registrieren.
% Der alte Benutzername wird dann aus der Blockchain gelöscht. -> wie könnte man das absichern?

\subsection{Kommunikation}
Für die Kommunikation mit anderen Teilnehmern, muss zunächst die ID des anderen Teilnehmers im Kademlia-Netzwerk bekannt sein. Dazu wird der Benutzername des anderen Teilnehmers auf der Blockchain gesucht um zu kontrollieren, ob dieser bereits registriert ist. Ist der Benutzername nicht auf der Blockchain vorhanden, ist der andere Teilnehmer nicht registriert und es kann keine Verbindung aufgebaut werden. Ist der Benutzername auf der Blockchain vorhanden, wird der dazugehörige öffentliche Schlüssel ausgelesen. Der Benutzername entspricht gleichzeitig der ID des Teilnehmers im Kademlia-Netzwerk. Somit kann der Verbindungsaufbau, der in Abschnitt \ref{subsec:verbindungsmanagement} \nameref{subsec:verbindungsmanagement} beschrieben wird, durchgeführt werden.
Wenn der Verbindungsaufbau erfolgreich war, kann die Kommunikation beginnen. Dazu wird der öffentliche Schlüssel des anderen Teilnehmers benötigt. Dieser wird ebenfalls auf der Blockchain gespeichert. Somit kann jeder Teilnehmer die öffentlichen Schlüssel der anderen Teilnehmer auf der Blockchain finden und die Nachrichten, die er erhält, mit dem öffentlichen Schlüssel des Absenders verifizieren. Somit kann sichergestellt werden, dass die Nachrichten tatsächlich vom angegebenen Absender stammen und nicht von einem anderen Teilnehmer gesendet wurden, der sich als jemand anderes ausgibt.

\subsection{Entwurf der Smart Contracts}
\label{subsec:smartcontracts}

Auf der Ethereum-Blockchain wird die hauptsächlich Programmiersprache Solidity verwendet, um Smart Contracts zu erstellen. Solidity ist eine objektorientierte Programmiersprache, die stark an JavaScript angelehnt ist \parencite[S. 131]{Antonopoulos_MasteringEthereum}. Die Smart Contracts, die für das Protokoll benötigt werden, sind in Solidity implementiert.


