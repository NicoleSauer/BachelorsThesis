\section{Identifikation von Teilnehmern}
\label{subsec:identifikation_von_teilnehmern}

Da es in Peer-to-Peer-Netzwerken keinen zentralen Server gibt, der unter anderem zur Auffindung und Identifikation anderer Teilnehmer verwendet werden kann, müssen die Teilnehmer auf andere Weise identifiziert werden. Durch die Entscheidung, das Kademlia Protokoll zu implementieren, wird die ID des Teilnehmers als Schlüssel für die Speicherung der Teilnehmerinformationen, wie IP-Adresse und Port, verwendet.

Aus der Spezifikation von Kademlia geht hervor, dass die ID einer Node, welche auch als \textit{Kademlia-ID} bezeichnet wird, 160 Bit lang sein muss und aus einer zufälligen Kennung bestehen soll \parencite[S. 2]{Maymounkov_Kademlia}. Für das hier entwickelte Protokoll wird der Benutzername des Teilnehmers als ID verwendet. Da Kademlia eine ID mit einer Länge von 160 Bit erwartet, muss der Benutzername auf diese Länge gebracht werden. Dafür wird eine Zeichenbegrenzung von 20 Zeichen festgelegt, was bei einer UTF-8 Codierung einer Bitlänge von 160 Bit entspricht \parencite{rfc3629_utf-8}. Falls der Benutzername kürzer als 20 Zeichen ist, wird er mit Nullen aufgefüllt.
Der Benutzername muss, wie aus den funktionalen Anforderungen (siehe \ref{subsec:registrierung}) zu entnehmen ist, eindeutig sein und kann vom Benutzer bei der Registrierung frei gewählt werden. Außerdem wird bei der Registrierung ein privater und ein öffentlicher Schlüssel erzeugt. Der öffentliche Schlüssel wird zusammen mit dem Benutzernamen in der Blockchain gespeichert. Der private Schlüssel wird lokal auf dem Gerät des Teilnehmers gespeichert. Durch die Beschränkung der ID auf 20 Zeichen wird die Anzahl der Teilnehmer zwar begrenzt, jedoch ist die Anzahl der möglichen Teilnehmer immer noch sehr groß. Es können in der Theorie $2^{160}$ Teilnehmer am Netzwerk teilnehmen, wobei nicht jedes Zeichen in UTF-8 sinnvoll für die Verwendung in einem Benutzername ist. Somit ist die Anzahl der möglichen Teilnehmer in der Praxis geringer.

Diese Anzahl ist so groß, dass sie in der Praxis nicht erreicht werden sollte und somit die Beschränkung der ID keine Auswirkungen auf die Funktionalität des Protokolls haben sollte.
In der Node werden dann Schlüssel-Wert-Paare gespeichert, wobei der Schlüssel die ID des Teilnehmers ist und der Wert die IP-Adresse und der Port. Es wird festgelegt, dass immer Port $49152$ verwendet wird, da sich dieser Port im Bereich der dynamischen Ports befindet und somit nicht für andere Anwendungen reserviert ist \parencite[S. 20]{rfc6335_IANA_Ports}. 

Wenn ein Teilnehmer eine Nachricht an einen anderen Teilnehmer senden möchte, muss er dessen IP-Adresse kennen. Um an diese Information zu gelangen, muss zuerst die ID des Teilnehmers in der Blockchain gesucht werden und anschließend eine Peer-Discovery durchgeführt werden, um die IP-Adresse des Teilnehmers zu erhalten. Eine Peer-Discovery läuft wie folgt ab:

\begin{enumerate}
    \item Alice hasht den Benutzernamen von Bob mit der SHA-1 Hashfunktion und erhält damit die Kademlia-ID von Bob.
    \item Alice sendet eine \textit{FIND\_NODE}-Nachricht an den Knoten in ihrer Routing-Tabelle, der der Kademlia-ID von Bob am nächsten ist. 
    \item Der Knoten sucht in seiner Routing-Tabelle nach der Kademlia-ID von Bob. Falls er den Knoten findet, antwortet er mit den gefundenen Informationen in Form eines Tripletts aus Kademlia-ID, IP-Adresse und Port. Falls der Knoten den Knoten nicht findet, antwortet er mit mehreren Triplets, die dem Knoten mit der Kademlia-ID von Bob am nächsten sind.
    \item Alice erhält die Antwort und sucht in der Antwort nach der Kademlia-ID von Bob. Falls sie gefunden wird, speichert Alice die IP-Adresse und den Port von Bob in ihrer Routing-Tabelle ab. Falls sie nicht gefunden wird, wiederholt Alice Schritt 2 solange, bis sie keine Antworten mehr erhält, die IDs beinhalten, die der Kademlia-ID von Bob näher sind als die ID des Knotens, der die \textit{FIND\_NODE}-Nachricht erhalten hat.
\end{enumerate}


\noindent Um das Netzwerk immer aktuell zu halten, wird in regelmäßigen Abständen ein \textit{PING} an alle Teilnehmer gesendet, die in den Routing-Tabellen der Nodes gespeichert sind. Falls ein Teilnehmer nicht antwortet, wird er aus der Routing-Tabelle entfernt.
