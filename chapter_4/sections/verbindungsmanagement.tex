\section{Verbindungsmanagement}
\label{subsec:routing}

\begin{itemize}
    \item Verbindungsaufbau
    \item Nachrichtenübertragung
    \item Verbindungsabbau
\end{itemize}

% Nachdem die IP-Adresse und Port des Empfängers ermittelt wurden, kann die Nachricht auf dem direkten Weg an den Empfänger gesendet werden
% Für die Kommunikation wird das ICE Protokoll verwendet
% #TODO: ICE Protokoll verwenden, um die Verbindung aufzubauen, wenn die direkte Verbindung nicht möglich ist
% #TODO: Wie verbinde ich Kademlia und ICE? -> Kademlia für die Peer Discovery und ICE für den Verbindungsaufbau?
% #TODO: Zustellbestätigung?

\noindent Das Verbindungsmanagement ist ein wichtiger Bestandteil des Protokolldesigns, da es die Grundlage für die Kommunikation zwischen den Teilnehmern bildet. Es ist dafür verantwortlich, dass die Nachrichtenübertragung zwischen den Teilnehmern funktioniert. Dazu gehört der Verbindungsaufbau, die Nachrichtenübertragung und der Verbindungsabbau.

Nachdem die IP-Adresse und der Port des Ziels mittels des Kademlia-Netzwerks ermittelt wurden, wird das ICE (Interactive Connectivity Establishment)-Protokoll zur Herstellung einer zuverlässigen Verbindung genutzt. ICE ermöglicht eine effiziente Kommunikation zwischen den beteiligten Geräten, selbst wenn sich eines oder beide Geräte hinter Netzwerkadressübersetzungen (NATs) oder Firewalls befinden. Dazu werden die verfügbaren Verbindungsarten ermittelt und die beste Verbindung ausgewählt. Die Verbindungsarten werden in der Reihenfolge ihrer Priorität ausgewählt. Die Priorität wird durch die Kosten der Verbindung bestimmt. Die Kosten einer Verbindung werden durch die folgende Formel berechnet:

\begin{equation}
    \label{eq:ice_kosten}
    \text{Kosten} = \text{Kostenbasis} + \text{Kostenfaktor} \cdot \text{Kostenindex}
\end{equation}

\noindent Die Kostenbasis ist ein Wert, der für jede Verbindungsart festgelegt wird. Der Kostenfaktor ist ein Wert, der für jede Verbindungsart festgelegt wird. Der Kostenindex ist ein Wert, der für jede Verbindung individuell berechnet wird. Die Kostenbasis und der Kostenfaktor werden in der Spezifikation von ICE festgelegt \parencite[S. 15]{rfc8445_ice}. Die Kostenbasis und der Kostenfaktor werden in der Spezifikation von ICE festgelegt \parencite[S. 15]{rfc8445_ice}.






Basierend auf den durch Kademlia erhaltenen Informationen, einschließlich der IP-Adresse und des Ports des Ziels, werden potenzielle Verbindungsadressen für beide Geräte gesammelt. Diese Adressen umfassen Host-Adressen, reflexive Adressen (die über STUN ermittelt werden) sowie Weiterleitungsadressen (von TURN).




\textbf{\textcolor{red}{TODO: UML-Diagramm für Verbindungsaufbau erstellen}}








