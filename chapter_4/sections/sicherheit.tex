\section{Sicherheit}
\label{subsec:sicherheit}

% #TODO: Sessions könnten so ca. 10 Minuten dauern, dann wird ein neuer symmetrischer Schlüssel ausgehandelt
% Diffie-Hellman-Schlüsselaustausch basiert auf Gruppen, die aus einem Generator und einer Primzahl bestehen. Die Gruppen werden so gewählt, dass der diskrete Logarithmus in diesen Gruppen schwer zu berechnen ist. Der diskrete Logarithmus ist das inverse Element der Exponentialfunktion. Das bedeutet, dass der diskrete Logarithmus die Lösung der Gleichung $g^x = y$ ist, wobei $g$ der Generator, $x$ der diskrete Logarithmus und $y$ das Ergebnis der Exponentialfunktion ist. Die Schwierigkeit des diskreten Logarithmus ist, dass es keine effiziente Methode gibt, um ihn zu berechnen. Die Sicherheit des Diffie-Hellman-Schlüsselaustauschs basiert auf der Annahme, dass es keine effiziente Methode gibt, um den diskreten Logarithmus zu berechnen. Eine Gruppe kann aber auch aus einem elliptischen Kurvenpunkt und einer Primzahl bestehen. Die Sicherheit des Diffie-Hellman-Schlüsselaustauschs basiert auf der Annahme, dass es keine effiziente Methode gibt, um das diskrete Logarithmusproblem in elliptischen Kurven zu lösen.



\textcolor{red}{Quellenangaben, falls nicht schon in Grundlagen gemacht}


\noindent Um die Kommunikation zwischen den Teilnehmern zu schützen, wird sowohl asymmetrische als auch symmetrische Verschlüsselung verwendet. Die asymmetrische Verschlüsselung wird für die Authentifizierung und die symmetrische Verschlüsselung für die Ende-zu-Ende-Verschlüsselung der Nachrichten verwendet. Die asymmetrische Verschlüsselung wird mit Hilfe von Public-Key-Kryptographie realisiert. In dem von Whitfield Diffie und Martin Hellman 1976 veröffentlichten Paper \textit{New Directions in Cryptography} \parencite{DiffieHellman_NewDirectionsInCryptography} wurde die Public-Key-Kryptographie erstmals beschrieben. Darin wird die Problematik der symmetrischen Verschlüsselung beschrieben, dass ein Schlüssel für die Verschlüsselung und Entschlüsselung verwendet wird und dieser Schlüssel zu Beginn der Kommunikation über einen unsicheren Kanal  zwischen den Teilnehmern ausgetauscht werden muss. Die Lösung dieses Problems ist die Public-Key-Kryptographie.


Bei der Public-Key-Kryptographie wird ein Schlüsselpaar generiert, das aus einem öffentlichen und einem privaten Schlüssel besteht. In diesem Protokoll wird bei der Registrierung eines Teilnehmers ein statisches Schlüsselpaar generiert. Der öffentliche Schlüssel dieses Schlüsselpaars wird gemeinsam mit dem Benutzernamen in der Blockchain hinterlegt und der private Schlüssel wird lokal auf dem Gerät des Teilnehmers gespeichert.

Um die Ende-zu-Ende-Verschlüsselung zu realisieren, wird ein Diffie-Hellman Schlüsselaustausch durchgeführt, der auf elliptischen Kurven basiert und daher auch Elliptic-Curve-Diffie-Hellman-Schlüsselaustausch (oder kurz ECDH) genannt wird. Als Grundlage für einen Schlüsselaustausch muss sich auf eine gemeinsame elliptische Kurvengleichung geeinigt werden. Für das hier entwickelte Protokoll wird die Funktion \textit{X448} verwendet, die in RFC 7748 \textit{The X25519 and X448 Elliptic Curves} \parencite{rfc_ellipticCurves} spezifiziert ist.



Der Diffie-Hellman-Schlüsselaustausch basiert auf der Annahme, dass es keine effiziente Methode gibt, um den diskreten Logarithmus zu berechnen. Der Diffie-Hellman-Schlüsselaustausch basiert auf Gruppen, die aus einem Generator und einer Primzahl bestehen. Die Gruppen werden so gewählt, dass der diskrete Logarithmus in diesen Gruppen schwer zu berechnen ist. Der diskrete Logarithmus ist das inverse Element der Exponentialfunktion. Das bedeutet, dass der diskrete Logarithmus die Lösung der Gleichung $g^x = y$ ist, wobei $g$ der Generator, $x$ der diskrete Logarithmus und $y$ das Ergebnis der Exponentialfunktion ist. Die Schwierigkeit des diskreten Logarithmus ist, dass es keine effiziente Methode gibt, um ihn zu berechnen. Eine Gruppe kann aber auch aus einem elliptischen Kurvenpunkt und einer Primzahl bestehen. Die Sicherheit des Diffie-Hellman-Schlüsselaustauschs basiert auf der Annahme, dass es keine effiziente Methode gibt, um das diskrete Logarithmusproblem in elliptischen Kurven zu lösen.




Bei einem Verbindungsaufbau wird vom Sender ein neues Schlüsselpaar generiert, welches diesmal aus flüchtigen Schlüsseln besteht. Der Sender generiert einen flüchtigen privaten Schlüssel und einen flüchtigen öffentlichen Schlüssel. Der flüchtige öffentliche Schlüssel wird zusammen mit der ID des Senders und einem Zeitstempel in einer Nachricht, welche mit dem statischen privaten Schlüssel des Senders signiert wird, an den Empfänger gesendet. Der Empfänger kann die Nachricht mit dem öffentlichen Schlüssel des Senders, welcher mittels Smart Contract aus der Blockchain ausgelesen werden kann, entschlüsseln und somit die Authentizität des Senders verifizieren. Dadurch kann der Empfänger sicher sein, dass die Nachricht vom Sender stammt und nicht von einem Angreifer manipuliert wurde. Mit Hilfe des Zeitstempels kann der Empfänger außerdem feststellen, ob der flüchtige öffentliche Schlüssel noch gültig ist. Der Empfänger extrahiert den flüchtigen öffentlichen Schlüssel aus der Nachricht des Senders und ist somit im Besitz des flüchtigen öffentlichen Schlüssels des Senders. Der Empfänger generiert ebenfalls einen flüchtigen privaten Schlüssel und einen flüchtigen öffentlichen Schlüssel. Der flüchtige öffentliche Schlüssel wird zusammen mit der ID des Empfängers und einem Zeitstempel in einer Nachricht, welche mit dem statischen privaten Schlüssel des Empfängers signiert wird, an den Sender gesendet. Der Sender kann die Nachricht mit dem öffentlichen Schlüssel des Empfängers entschlüsseln und somit die Authentizität des Empfängers verifizieren. Nun sind beide Teilnehmer im Besitz des flüchtigen öffentlichen Schlüssels des jeweils anderen Teilnehmers.


Anschließend wird ein gemeinsamer geheimer Schlüssel aus dem flüchtigen privaten Schlüssel und dem öffentlichen Schlüssel des Empfängers mittels Key-Derivation-Funktion berechnet und die flüchtigen Schlüssel werden verworfen. Der berechnete flüchtige symmetrische Schlüssel wird für die Verschlüsselung der Nachrichten verwendet.

Durch die Anwendung von flüchtigen Schlüsseln wird die Sicherheit erhöht, da diese nur für eine kurze Zeit existieren und somit ein Angreifer nur für einen kurzen Zeitraum Zugriff auf diese hat. Mit Hilfe dieser Methode wird eine Ende-zu-Ende-Verschlüsselung ermöglicht, da nur der Sender und der Empfänger den gemeinsamen geheimen Schlüssel kennen. Selbst wenn die Verbindung über ein Relay läuft, kann dieses die Nachricht nicht entschlüsseln, da es den gemeinsamen geheimen Schlüssel nicht kennt. Die Verwendung von flüchtigen Schlüsseln hat jedoch auch Nachteile. So muss bei jedem Verbindungsaufbau ein neues Schlüsselpaar generiert werden, was einen erhöhten Rechenaufwand bedeutet. 

